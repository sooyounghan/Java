-----
### 파일 입출력과 성능 최적화 3 - Buffered 스트림 쓰기
-----
1. BufferedOutputStream은 버퍼 기능을 내부에서 대신 처리
2. 따라서, 단순한 코드를 유지하면서 버퍼를 사용하는 이점도 누릴 수 있음
3. CreateFileV3
```java
package io.buffered;

import java.io.BufferedOutputStream;
import java.io.FileOutputStream;
import java.io.IOException;

import static io.buffered.BufferedConst.*;

public class CreateFileV3 {
    public static void main(String[] args) throws IOException {
        FileOutputStream fos = new FileOutputStream(FILE_NAME);

        BufferedOutputStream bos = new BufferedOutputStream(fos, BUFFER_SIZE);// BufferedOutputStream(OutputStream, BUFFER_SIZE)
        
        long startTime = System.currentTimeMillis();

        for(int i = 0; i < FILE_SIZE; i++) {
            bos.write(1); // 1 byte 씩 작성
        }

        bos.close();

        long endTime = System.currentTimeMillis();

        System.out.println("File Created : " + FILE_NAME);
        System.out.println("File Size : " + FILE_SIZE / 1024 / 1024 + "MB");
        System.out.println("File Taken = " + (endTime - startTime) + "ms");
    }
}
```
  - BufferedOutputStream은 내부에서 단순히 버퍼 기능만 제공
  - 따라서 반드시 대상 OutputStream이 있어야 하므로, 여기서는 FileOutputStream 객체를 생성자에 전달
  - 코드를 보면 버퍼를 위한 byte[]를 직접 다루지 않고, 단순하게 코드 작성 가능
  - 실행 결과
```
File Created : temp/buffered.dat
File Size : 10MB
File Taken = 421ms
```
  - 140배 정도 빠르게 처리

4. BufferedOutputStream 분석
<div align="center">
<img src="https://github.com/user-attachments/assets/b25501d9-12dc-4b6e-9d8a-1423e6f03ced">
</div>

  - BufferedOutputStream은 OutputStream을 상속받는데, OutputStream과 같은 기능을 그대로 사용 가능 (write() 사용 가능)

5. BufferedStreamOutput 실행 순서
<div align="center">
<img src="https://github.com/user-attachments/assets/08152f13-17ba-4390-8721-e04ec9dd2b23">
</div>

  - BufferedOutputStream은 내부 byte[] buf 라는 버퍼를 가지고 있음 (여기서 버퍼의 크기를 3이라 가정)
  - BufferedOutputStream에 write(byte)를 통해 byte 하나를 전달하면 byte[] buf에 보관
    + 참고로, 실제로는 write(int) 타입이지만, 설명을 위해 write(byte)로 설명

<div align="center">
<img src="https://github.com/user-attachments/assets/c8d18f8c-03a5-4218-9449-d566fc7284f3">
</div>

  - write(byte)를 2번 호출 (아직 버퍼가 가득 차지 않음)

<div align="center">
<img src="https://github.com/user-attachments/assets/ab28c006-ff07-4945-87b9-258d79db9021">
</div>

  - write(byte)를 3번 호출하면 버퍼가 가득 참
  - 버퍼가 가득차면 FileOutputStream에 있는 write(byte[]) 메서드 호출
    + 참고로, BufferedOutputStream의 생성자에서 FileOutputStream, fos를 전달
  - FileOutputStream의 write(byte[])를 호출하면, 전달된 모든 byte[]를 시스템 콜로 OS에 전달

<div align="center">
<img src="https://github.com/user-attachments/assets/3fdbd692-4fea-4ec2-a500-80abf163beb2">
</div>

  - 버퍼의 데이터를 모두 전달했으므로 버퍼 내용을 비움
  - 이후 write(byte)가 호출되면, 다시 버퍼를 채우는 식으로 반복
