-----
### ë„¤íŠ¸ì›Œí¬ í”„ë¡œê·¸ë¨6 - ìì›ì •ë¦¬3
-----
1. ì„œë²„ë¥¼ ì¢…ë£Œí•  ë•Œ, ì„œë²„ ì†Œì¼“ê³¼ ì—°ê²°ëœ ëª¨ë“  ì†Œì¼“ ìì›ì„ ë‹¤ ë°˜ë‚©í•˜ê³  ì„œë²„ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ì¢…ë£Œí•˜ëŠ” ë°©ë²•
2. ì„œë²„ë¥¼ ì¢…ë£Œí•˜ë ¤ë©´ ì„œë²„ì— ì¢…ë£Œë¼ëŠ” ì‹ í˜¸ë¥¼ ì „ë‹¬í•´ì•¼ í•¨
   - ì˜ˆë¥¼ ë“¤ì–´, ì„œë²„ë„ ì½˜ì†” ì°½ì„ í†µí•´ ì…ë ¥ì„ ë°›ë„ë¡ ë§Œë“¤ê³ , 'ì¢…ë£Œ'ë¼ëŠ” ë©”ì„¸ì§€ë¥¼ ì…ë ¥í•˜ë©´, ëª¨ë“  ìì›ì„ ì •ë¦¬í•˜ë©´ì„œ ì„œë²„ê°€ ì¢…ë£Œë˜ë„ë¡ í•˜ë©´ ë¨
   - í•˜ì§€ë§Œ, ë³´í†µ ì„œë²„ì—ì„œ ì½˜ì†” ì…ë ¥ì€ ì˜ í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ì„œë²„ë¥¼ ì§ì ‘ ì¢…ë£Œí•˜ë©´ì„œ ìì›ë„ í•¨ê»˜ ì •ë¦¬

3. ì…§ë‹¤ìš´ í›… (Shutdown Hook)
   - ìë°”ì—ì„œ í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œë  ë•Œ, ìì› ì •ë¦¬ë‚˜ ë¡œê·¸ ê¸°ë¡ê³¼ ê°™ì€ ì¢…ë£Œ ì‘ì—…ì„ ë§ˆë¬´ë¦¬í•  ìˆ˜ ìˆëŠ” ì…§ë‹¤ìš´ í›…ì´ë¼ëŠ” ê¸°ëŠ¥ ì§€ì›
   - í”„ë¡œì„¸ìŠ¤ ì¢…ë£ŒëŠ” í¬ê²Œ 2ê°€ì§€ë¡œ ë¶„ë¥˜
     + ì •ìƒ ì¢…ë£Œ
       * ëª¨ë“  Non-Demon Threadì˜ ì‹¤í–‰ ì™„ë£Œë¡œ ìë°” í”„ë¡œì„¸ìŠ¤ ì •ìƒ ì¢…ë£Œ
       * ì‚¬ìš©ìê°€ Ctrl + Cë¥¼ ëˆŒëŸ¬ í”„ë¡œê·¸ë¨ ì¤‘ë‹¨ (ì½˜ì†”)
       * kill ëª…ë ¹ ì „ë‹¬ (kill -9 ì œì™¸)
       * InteliJì˜ Stop ë²„íŠ¼

     + ê°•ì œ ì¢…ë£Œ
       * ìš´ì˜ì²´ì œì—ì„œ í”„ë¡œì„¸ìŠ¤ë¥¼ ë” ì´ìƒ ìœ ì§€í•  ìˆ˜ ì—†ë‹¤ê³  íŒë‹¨í•  ë•Œ ì‚¬ìš©
       * ë¦¬ëˆ…ìŠ¤ / ìœ ë‹‰ìŠ¤ì˜ kill -9ë‚˜ Windowsì˜ taskkill /F

  - ì •ìƒ ì¢…ë£Œì˜ ê²½ìš°ì—ëŠ” ì…§ë‹¤ìš´ í›…ì´ ì‘ë™í•´ì„œ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ì „ì— í•„ìš”í•œ í›„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ
  - ë°˜ë©´ì—, ê°•ì œ ì¢…ë£Œì˜ ê²½ìš° ì…§ë‹¤ìš´ í›…ì´ ì‘ë™í•˜ì§€ ì•ŠìŒ

4. ì…§ë‹¤ìš´ í›…ì„ ì´ìš©í•´, ì„œë²„ ì¢…ë£Œ ì‹œ ìì› í•¨ê»˜ ì •ë¦¬
5. ClientV6 (/tcp/v6) - í´ë¼ì´ì–¸íŠ¸ ì½”ë“œëŠ” ê¸°ì¡´ ì½”ë“œì™€ ë™ì¼
```java
package network.tcp.v6;

import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;
import java.net.Socket;
import java.util.Scanner;

import static util.MyLogger.log;

public class ClientV6 {
    private static final int PORT = 12345; // PORT

    public static void main(String[] args) throws IOException {
        log(" í´ë¼ì´ì–¸íŠ¸ ì‹œì‘");

        // Socket, InputStream, OutputStream ëª¨ë‘ Autocloseable êµ¬í˜„
        try(Socket socket = new Socket("localhost", PORT);// Host : Localhost > TCP/IPë¥¼ í†µí•´ localhost:portë¡œ ì ‘ì†
            DataInputStream input = new DataInputStream(socket.getInputStream()); // Socketì˜ InputStreamì„ DataInputStream ë³´ì¡°ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ì‚¬ìš©
            DataOutputStream output = new DataOutputStream(socket.getOutputStream())) { // Socketì˜ OutputStreamì„ DataOutputStream ë³´ì¡°ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ì‚¬ìš©

            log("ì†Œì¼“ ì—°ê²°: " + socket);

            Scanner scanner = new Scanner(System.in);

            while (true) {
                System.out.print("ì „ì†¡ ë¬¸ì: ");
                String toSend = scanner.nextLine();

                // ì„œë²„ë¡œë¶€í„° ë¬¸ì ë³´ë‚´ê¸°
                output.writeUTF(toSend);
                log("client -> server: " + toSend);

                // exitë¼ê³  ì…ë ¥í•˜ë©´ ì¢…ë£Œ
                if(toSend.equals("exit")) {
                    break;
                }

                // ì„œë²„ë¡œë¶€í„° ë¬¸ì ë°›ê¸°
                String received = input.readUTF();
                log("client <- server: " + received);
            }
        } catch (IOException e) {
            log(e);
        }
    }
}
```

6. ì„œë²„ëŠ” ì„¸ì…˜ì„ ê´€ë¦¬í•˜ëŠ” ì„¸ì…˜ ë§¤ë‹ˆì €ê°€ í•„ìš”
<div align="center">
<img src="https://github.com/user-attachments/assets/be80a572-d410-45fc-8fa6-23a995c369e1">
</div>

  - ê° ì„¸ì…˜ì€ ì†Œì¼“ ì—°ê²° ìŠ¤íŠ¸ë¦¼ì„ ê°€ì§€ê³  ìˆìŒ
  - ë”°ë¼ì„œ, ì„œë²„ë¥¼ ì¢…ë£Œí•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì„¸ì…˜ë“¤ë„ í•¨ê»˜ ì¢…ë£Œë˜ì–´ì•¼ í•¨
  - ë”°ë¼ì„œ, ëª¨ë“  ì„¸ì…˜ì„ ì°¾ì•„ì„œ ì¢…ë£Œí•˜ë ¤ë©´, ìƒì„±í•œ ì„¸ì…˜ì„ ë³´ê´€í•˜ê³  ê´€ë¦¬í•  ê°ì²´ í•„ìš”

   - SessionManagerV6
```java
package network.tcp.v6;

import java.util.ArrayList;
import java.util.List;

// ë™ì‹œì„± ì²˜ë¦¬ í•„ìš”
public class SessionManagerV6 {
    private List<SessionV6> sessions = new ArrayList<>(); // ì„¸ì…˜ ê°ì²´ë¥¼ ë‹´ì„ ArrayList

    public synchronized void add(SessionV6 session) { // ì„¸ì…˜ ì¶”ê°€ (ë™ê¸°í™” í•„ìš”)
        sessions.add(session);
    }

    public synchronized void remove(SessionV6 session) { // ì„¸ì…˜ ì œê±° (ë™ê¸°í™” í•„ìš”)
        sessions.remove(session);
    }

    // ë™ê¸°í™” í•„ìš”
    public synchronized void closeAll() { // ì„¸ì…˜ ëª¨ë‘ ì •ë¦¬ (ì„œë²„ ì¢…ë£Œë˜ë©´, ëª¨ë“  ì„¸ì…˜ ì¢…ë£Œ) > ì¦‰, ëª¨ë“  ì„¸ì…˜ì´ ì‚¬ìš©í•˜ëŠ” ìì›(Socket, InputStream, OutputStream ì •ë¦¬
        for (SessionV6 session : sessions) {
            session.close();
        }

        sessions.clear();
    }
}
```

  + add() : í´ë¼ì´ì–¸íŠ¸ì˜ ìƒˆë¡œìš´ ì—°ê²°ì„ í†µí•´, ì„¸ì…˜ì´ ë§Œë“¤ì–´ì§€ëŠ” ê²½ìš° add()ë¥¼ í˜¸ì¶œí•´, ì„¸ì…˜ ë§¤ë‹ˆì €ì— ì„¸ì…˜ ì¶”ê°€
  + remove() : í´ë¼ì´ì–¸íŠ¸ì˜ ì—°ê²°ì´ ëŠì–´ì§€ë©´, ì„¸ì…˜ë„ í•¨ê»˜ ì •ë¦¬í•´ì•¼ í•˜ëŠ”ë°, ì´ ê²½ìš° remove()ë¥¼ í˜¸ì¶œí•´ ì„¸ì…˜ ë§¤ë‹ˆì €ì—ì„œ ì„¸ì…˜ ì œê±°
  + closeAll() : ì„œë²„ë¥¼ ì¢…ë£Œí•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì„¸ì…˜ë“¤ë„ ëª¨ë‘ ë‹«ê³ , ì •ë¦¬

  - SessionV6
```java
package network.tcp.v6;

import network.tcp.SocketCloseUtil;

import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;
import java.net.Socket;

import static util.MyLogger.log;

public class SessionV6 implements Runnable { // ë³„ë„ì˜ Threadì—ì„œ êµ¬í˜„ì„ ìœ„í•´ Runnable Implement
    private final Socket socket; // Session ê°ì²´ ë‚´ë¶€ì— socket í•„ìš”
    private final DataInputStream input; // close()ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì™¸ë¶€ì— ì„ ì–¸
    private final DataOutputStream output; // close()ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì™¸ë¶€ì— ì„ ì–¸
    private final SessionManagerV6 sessionManager;
    private boolean closed = false; // ì„¸ì…˜ì—ì„œ ì‚¬ìš©í•˜ëŠ” close() ì‚¬ìš© ìœ ë¬´

    public SessionV6(Socket socket, SessionManagerV6 sessionManager) throws IOException {
        this.socket = socket;

        this.input = new DataInputStream(socket.getInputStream());
        this.output = new DataOutputStream(socket.getOutputStream());

        this.sessionManager = sessionManager;
        this.sessionManager.add(this); // ì„¸ì…˜ ë§¤ë‹ˆì €ì— ìƒì„±ëœ Socket ì¶”ê°€
    }

    @Override
    public void run() {
        // try - with resource ì‚¬ìš© ë³´ë‹¤ try ~ catch ~ finally
        try {
            
            while (true) {
                // í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë¬¸ì ë°›ê¸°
                String received = input.readUTF(); // ì„œë²„ ì…ì¥ì—ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ ë©”ì„¸ì§€ë¥¼ ë°›ìŒ
                log("client -> server: "  + received);

                // ë§Œì•½, ë°›ì€ ë©”ì„¸ì§€ê°€ exitë¼ë©´ ì¢…ë£Œ
                if(received.equals("exit")) {
                    break;
                }

                // í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë¬¸ì ë³´ë‚´ê¸°
                String toSend = received + " World!";
                output.writeUTF(toSend);
                log("client <- server: " + toSend);
            }

        } catch (IOException e) {
            log(e);
        } finally {
            sessionManager.remove(this); // ë¨¼ì €, SessionManagerì—ì„œ í•´ë‹¹ Session ì œê±°
            close(); // ì˜ˆì™¸ê°€ ë°œìƒí•˜ê±°ë‚˜ ë°œìƒí•˜ì§€ ì•Šë”ë¼ë„ ìµœì¢…ì ìœ¼ë¡œ finally êµ¬ë¬¸ì—ì„œ close() í˜¸ì¶œ
        }

    }

    // ì„¸ì…˜ ì¢…ë£Œì™€ ë™ì‹œì— ì„œë²„ ì¢…ë£Œ ì‹œ ë™ì‹œ í˜¸ì¶œ ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë™ì‹œì„± ì²˜ë¦¬ í•„ìš”
    public synchronized void close() { // ëª¨ë“  ìì› ë‹«ê¸°
        
        // ë™ì‹œì— í˜¸ì¶œì€ ë˜ì§€ ì•Šì§€ë§Œ, ë‘ ë²ˆ í˜¸ì¶œë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì´ë¥¼ ì²˜ë¦¬
        if (closed) { // ì´ë¯¸ close()ê°€ í˜¸ì¶œë˜ì—ˆë‹¤ë©´, return
            return; 
        }
        
        SocketCloseUtil.closeAll(socket, input, output); // SessionManagerV6ì—ì„œ ìì›ì„ ë‹¤ ë‹«ì„ ë•Œ ì‚¬ìš©
        closed = true; // í˜¸ì¶œë˜ì—ˆìœ¼ë¯€ë¡œ trueë¡œ ë³€ê²½ë˜ë¯€ë¡œ ì¤‘ë³µ í˜¸ì¶œ ë¶ˆê°€
        
        log("ì—°ê²° ì¢…ë£Œ: " + socket + " isClosed: " + socket.isClosed());
    }
}
```
  - Sessionì—ì„œ try - with - resources ì‚¬ìš© ë¶ˆê°€ (ì„œë²„ë¥¼ ì¢…ë£Œí•˜ëŠ” ì‹œì ì—ë„ Session ìì› ì •ë¦¬í•´ì•¼ ë˜ê¸° ë–„ë¬¸ì„)

7. ğŸ’¡ try - with - resourcesëŠ” ì‚¬ìš©ê³¼ í•´ì œë¥¼ í•¨ê»˜ ë¬¶ì–´ì„œ ì²˜ë¦¬í•  ë•Œ ì‚¬ìš©
   - try - with - resourcesëŠ” try ì„ ì–¸ë¶€ì— ì‚¬ìš©í•œ ìì›ì„ tryê°€ ëë‚˜ëŠ” ì‹œì ì— ì •ë¦¬
   - ë”°ë¼ì„œ, tryì—ì„œ ìì›ì˜ ì„ ì›ê³¼ ìì› ì •ë¦¬ë¥¼ ë¬¶ì–´ì„œ ì²˜ë¦¬í•  ë•Œ ì‚¬ìš© ê°€ëŠ¥
   - í•˜ì§€ë§Œ, ì§€ê¸ˆì€ ì„œë²„ë¥¼ ì¢…ë£Œí•˜ëŠ” ì‹œì ì—ë„ Sessionì´ ì‚¬ìš©í•˜ëŠ” ìì›ì„ ì •ë¦¬í•´ì•¼ í•¨
   - ì„œë²„ë¥¼ ì¢…ë£Œí•˜ëŠ” ì‹œì ì— ìì›ì„ ì •ë¦¬í•˜ëŠ” ê²ƒì€ Session ì•ˆì— ìˆëŠ”ë°, try - with - resourcesë¥¼ í†µí•´ ì²˜ë¦¬ ë¶ˆê°€

8. ë™ì‹œì„¸ ë¬¸ì œ
```java
public synchorized void clear() { ... }
```
  - ìì›ì„ ì •ë¦¬í•˜ëŠ” close() ë©”ì„œë“œëŠ” 2ê³³ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥ì„± ì¡´ì¬
    + í´ë¼ì´ì–¸íŠ¸ì™€ ì—°ê²°ì´ ì¢…ë£Œë˜ì—ˆì„ ë•Œ (exit ë˜ëŠ” ì˜ˆì™¸ ë°œìƒ)
    + ì„œë²„ë¥¼ ì¢…ë£Œí•  ë•Œ

  - ë”°ë¼ì„œ, close()ê°€ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì¤‘ë³µ í˜¸ì¶œë  ê°€ëŠ¥ì„± ì¡´ì¬
  - ì´ëŸ° ë¬¸ì œë¥¼ ë§‰ê¸° ìœ„í•´ synchorized í‚¤ì›Œë“œ ì‚¬ìš©
  - ê·¸ë¦¬ê³  ìì› ì •ë¦¬ ì½”ë“œê°€ ì¤‘ë³µ í˜¸ì¶œë˜ëŠ” ê²ƒì„ ë§‰ê¸° ìœ„í•´ closed ë³€ìˆ˜ë¥¼ í”Œë˜ê·¸ë¡œ ì‚¬ìš©
