-----
### ì±„íŒ… í”„ë¡œê·¸ë¨ - í´ë¼ì´ì–¸íŠ¸
-----
<div align="center">
<img src="https://github.com/user-attachments/assets/c1409085-742f-4583-88fb-261d9192a696">
</div>

1. í´ë¼ì´ì–¸íŠ¸ëŠ” ë‹¤ìŒ ë‘ ê¸°ëŠ¥ì„ ë³„ë„ì˜ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰
   - ì½˜ì†”ì˜ ì…ë ¥ì„ ë°›ì•„ ì„œë²„ë¡œ ì „ì†¡
   - ì„œë²„ë¡œë¶€í„° ì˜¤ëŠ” ë©”ì„¸ì§€ë¥¼ ì½˜ì†”ì— ì¶œë ¥
  
2. ì„œë²„ë¡œë¶€í„° ì˜¤ëŠ” ë©”ì„¸ì§€ë¥¼ ì½˜ì†”ì— ì¶œë ¥í•˜ëŠ” ê¸°ëŠ¥ (/chat/client/ReadHandler)
```java
package chat.client;

import util.MyLogger;

import java.io.DataInputStream;
import java.io.IOException;

import static util.MyLogger.*;

public class ReadHandler implements Runnable {
    private final DataInputStream input; // ì½˜ì†”ì„ í†µí•´ ë©”ì„¸ì§€ë¥¼ ì „ì†¡
    private final Client client; // í´ë¼ì´ì–¸íŠ¸ ê°ì²´
    private boolean closed = false; // ë‹«í˜ ì—¬ë¶€

    public ReadHandler(DataInputStream input, Client client) {
        this.input = input;
        this.client = client;
    }

    @Override
    public void run() {
            try {
                while(true) {
                    String received = input.readUTF();
                    System.out.println(received);
                }
            } catch (IOException e) {
                log(e);
            } finally { 
                client.close();
        }
    }
    
    public synchronized void close() { // ë™ì‹œ í˜¸ì¶œ ê°€ëŠ¥ì„± ì¡´ì¬ (Client ì¢…ë£Œ ë˜ëŠ” ReadHandler ì˜ˆì™¸ ë“±)
        if(closed) {
            return;
        }
        
        // ì¢…ë£Œ ë¡œì§ í•„ìš”ì‹œ ì‘ì„±
        closed = true;
        log("ReadHandler ì¢…ë£Œ");
    }
}
```
  - ReadHandlerëŠ” Runnable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³ , ë³„ë„ì˜ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰
  - ì„œë²„ì˜ ë©”ì„¸ì§€ë¥¼ ë°˜ë³µí•´ì„œ ë°›ê³ , ì½˜ì†”ì— ì¶œë ¥í•˜ëŠ” ë‹¨ìˆœ ê¸°ëŠ¥ ì œê³µ
  - í´ë¼ì´ì–¸íŠ¸ ì¢…ë£Œ ì‹œ ReadHandlerë„ ì¢…ë£Œ (ì¤‘ë³µ ì¢…ë£Œë¥¼ ë§‰ê¸° ìœ„í•´ ë™ê¸°í™” ì½”ë“œì™€ closed í”Œë˜ê·¸ ì‚¬ìš©)
    + ì°¸ê³ ë¡œ, ì˜ˆì œ ì½”ë“œëŠ” ë‹¨ìˆœí•˜ë¯€ë¡œ ì¤‘ìš” ë¡œì§ ì—†ìŒ
  - IOException ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´, client.close()ë¥¼ í†µí•´ ì¢…ë£Œí•˜ê³ , ì „ì²´ ìì› ì •ë¦¬

3. WriteHandler
```java
package chat.client;

import java.io.DataOutputStream;
import java.io.IOException;
import java.util.NoSuchElementException;
import java.util.Scanner;

import static util.MyLogger.log;

public class WriteHandler implements Runnable {
    private static String DELIMITER = "|"; // Delimiter : | êµ¬ë¶„ì

    private final DataOutputStream output;
    private final Client client;

    private boolean closed = false; // ë‹«í˜ ì—¬ë¶€ í™•ì¸

    public WriteHandler(DataOutputStream output, Client client) {
        this.output = output;
        this.client = client;
    }

    @Override
    public void run() {
        Scanner scanner = new Scanner(System.in);

        try {
            String username = inputUsername(scanner);

            // ì—°ê²° í›„, ì…ë ¥ë°›ì€ ì‚¬ìš©ì ì´ë¦„ì„ ì„œë²„ì— ì „ì†¡
            output.writeUTF("/join" + DELIMITER + username);

            // ì±„íŒ… ì…ë ¥
            while (true) {
                String toSend = scanner.nextLine(); // Blocking (System.inì„ Closeí•˜ë©´, ì˜ˆì™¸ ë°œìƒ -> NoSuchElementException)

                // ì•„ë¬´ëŸ° ë¬¸ìë¥¼ ì…ë ¥í•˜ì§€ ì•Šìœ¼ë©´, ë‹¤ì‹œ ì…ë ¥í•˜ë„ë¡ ì„¤ì •
                if(toSend.isEmpty()) {
                    continue;
                }

                // /exit ëª…ë ¹ì–´ ì…ë ¥ ì‹œ, ì„œë²„ì— ì „ì†¡ í›„ ë°˜ë³µë¬¸ íƒˆì¶œ (ì…ë ¥ ì¢…ë£Œ)
                if(toSend.equals("/exit")) {
                    output.writeUTF(toSend);
                    break;
                }

                // "/"ë¡œ ì‹œì‘í•˜ë©´ ëª…ë ¹ì–´, ë‚˜ë¨¸ì§€ëŠ” ì¼ë°˜ ë©”ì„¸ì§€ë¡œ êµ¬ë¶„
                if(toSend.startsWith("/")) {
                    // ì˜ˆ) "/users", "/change|{name}" ... : ëª…ë ¹ì–´ëŠ” ì„œë²„ë¡œ ê·¸ëŒ€ë¡œ ë³´ëƒ„
                    output.writeUTF(toSend);
                } else {
                    // hello, hi ë“± ì „ì²´ì—ê²Œ ë³´ë‚´ëŠ” ë©”ì„¸ì§€
                    output.writeUTF("/message" + DELIMITER + toSend); // /message|hello
                }


            }
        } catch (IOException | NoSuchElementException e) {
            log(e);
        } finally {
            client.close();
        }
    }

    private static String inputUsername(Scanner scanner) {
        // ì‚¬ìš©ì ì´ë¦„ ì…ë ¥
        System.out.println("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”. : ");
        String username;

        do {
            username = scanner.nextLine();
        } while (username.isEmpty());
        return username;
    }

    public synchronized void close() {
        if(closed) {
            return;
        }

        try {
            System.in.close(); // Scanner ì…ë ¥ ì¤‘ì§€ (ì‚¬ìš©ìì˜ ì…ë ¥ì„ ë‹«ìŒ) (Scannerë¥¼ ë‹«ì•„ì„œ ì¢…ë£Œ ë¶ˆê°€)
        } catch (IOException e) {
            log(e);
        }
        
        closed = true;
        log("WriteHandler ì¢…ë£Œ");
    }
}
```
  - WriteHandler : ì‚¬ìš©ì ì½˜ì†”ì„ ì…ë ¥ë°›ì•„ ì„œë²„ë¡œ ë©”ì„¸ì§€ ì „ì†¡
  - ì²˜ìŒ ì‹œì‘ ì‹œ inputUsername()ì„ í†µí•´ ì‚¬ìš©ì ì´ë¦„ ì…ë ¥
  - ì²˜ìŒ ì±„íŒ… ì„œë²„ì— ì ‘ì†í•˜ë©´ /join|{name}ì„ ì „ì†¡
    + ì´ ë©”ì„¸ì§€ë¥¼ í†µí•´ ì…ì¥í–ˆë‹¤ëŠ” ì •ë³´ì™€ ì‚¬ìš©ì ì´ë¦„ì„ ì„œë²„ì— ì „ë‹¬
  - ë©”ì„¸ì§€ ì„¤ê³„
    + ì…ì¥ : /join|{name}
    + ë©”ì„¸ì§€ : /message|{ë‚´ìš©}
    + ì¢…ë£Œ : /exit

  - ë§Œì•½ ì½˜ì†” ì…ë ¥ ì‹œ, /ë¡œ ì‹œì‘í•˜ë©´, /join, /exit ê°™ì€ íŠ¹ì • ëª…ë ¹ì–´ ìˆ˜í–‰
  - /ë¥¼ ì…ë ¥í•˜ì§€ ì•Šìœ¼ë©´, ì¼ë°˜ ë©”ì„¸ì§€ë¡œ ë³´ê³  /messageì— ë‚´ìš©ì„ ì¶”ê°€í•´ ì„œë²„ì— ì „ë‹¬

4. ğŸ’¡ close()ë¥¼ í˜¸ì¶œí•˜ë©´ System.in.close()ë¥¼ í†µí•´ ì‚¬ìš©ì ì½˜ì†” ì…ë ¥ì„ ë‹«ìŒ
   - Scannerë¥¼ í†µí•œ ì½˜ì†” ì…ë ¥ì¸ scanner.nextLine() ì½”ë“œì—ì„œ ëŒ€ê¸°í•˜ëŠ” ìŠ¤ë ˆë“œì— ë‹¤ìŒ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©°, ëŒ€ê¸° ìƒíƒœ ë²—ì–´ë‚¨
```java
java.util.NoSuchElementException: No line found
```
   - ì„œë²„ê°€ ì—°ê²°ì„ ëŠì€ ê²½ìš° í´ë¼ì´ì–¸íŠ¸ì˜ ìì›ì´ ì •ë¦¬ë˜ëŠ”ë°, ì´ ë•Œ ì‚¬ìš©
   - IOException ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ client.close()ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì¢…ë£Œí•˜ê³ , ì „ì²´ ìì› ì •ë¦¬
   - ìœˆë„ìš°ì˜ ê²½ìš°, System.in.close()ë¥¼ í˜¸ì¶œí•´ë„ ì‚¬ìš©ì ì½˜ì†” ì…ë ¥ì´ ë‹«íˆì§€ ì•ŠìŒ
   - ì‚¬ìš©ìê°€ ì–´ë–¤ ë‚´ìš©ì„ ì…ë ¥í•´ì•¼ ê·¸ ë‹¤ìŒ java.util.NoSuchElementException: No line found ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ì„œ ëŒ€ê¸° ìƒíƒœì—ì„œ ë²—ì–´ë‚¨

5. Client
```java
package chat.client;

import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;
import java.net.Socket;

import static network.tcp.SocketCloseUtil.closeAll;
import static util.MyLogger.log;

public class Client {

    private final String host;
    private final int port;

    private Socket socket;
    private DataInputStream input;
    private DataOutputStream output;

    private ReadHandler readHandler;
    private WriteHandler writeHandler;
    private boolean closed = false;


    public Client(String host, int port) {
        this.host = host;
        this.port = port;
    }

    public void start() throws IOException {
        log("í´ë¼ì´ì–¸íŠ¸ ì‹œì‘");
        socket = new Socket(host);
        input = new DataInputStream(socket.getInputStream());
        output = new DataOutputStream(socket.getOutputStream());

        readHandler = new ReadHandler(input, this);
        writeHandler = new WriteHandler(output, this);

        Thread readThread = new Thread(readHandler, "readHandler"); // ë³„ë„ì˜ Threadì—ì„œ ReadHandler ê°€ë™
        Thread writeThread = new Thread(writeHandler, "writeHandler"); // ë³„ë„ì˜ Threadì—ì„œ WriteHandler ê°€ë™

        readThread.start();
        writeThread.start();
    }

    // ë™ì‹œ í˜¸ì¶œ ì˜ˆë°©ì„ ìœ„í•´ ë™ì‹œì„± ì²˜ë¦¬
    public synchronized void close() {
        if (closed) {
            return;
        }

        writeHandler.close();
        readHandler.close();
        closeAll(socket, input,output); // ì „ì²´ ìì› ì •ë¦¬

        closed = true;
        log("ì—°ê²° ì¢…ë£Œ: " + socket);
    }
}
```
   - í´ë¼ì´ì–¸íŠ¸ ì „ë°˜ì„ ê´€ë¦¬í•˜ëŠ” í´ë˜ìŠ¤
   - Socket, ReadHandler, WriteHandlerë¥¼ ëª¨ë‘ ìƒì„±í•˜ê³  ê´€ë¦¬
   - close() ë©”ì„œë“œë¥¼ í†µí•´ ì „ì²´ ìì›ì„ ì •ë¦¬í•˜ëŠ” ê¸°ëŠ¥ë„ ì œê³µ

6. ClientMain
```java
package chat.client;

import java.io.IOException;

public class ClientMain {
    private static final int PORT = 12345;

    public static void main(String[] args) throws IOException {
        Client client = new Client("localhost", 12345);
        client.start();
    }
}
```
