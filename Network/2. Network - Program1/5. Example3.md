-----
### ë„¤íŠ¸ì›Œí¬ í”„ë¡œê·¸ë¨3
-----
1. ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ê°€ ë™ì‹œì— ì ‘ì†í•  ìˆ˜ ìˆëŠ” í”„ë¡œê·¸ë¨
<div align="center">
<img src="https://github.com/user-attachments/assets/a0c9559f-f6f8-4f49-9ea4-a9b687b8c081">
</div>

  - ì„œë²„ì˜ main ìŠ¤ë ˆë“œëŠ” ì„œë²„ ì†Œì¼“ì„ ìƒì„±í•˜ê³ , ì„œë²„ ì†Œì¼“ì˜ accept()ë¥¼ ë°˜ë³µí•´ì„œ í˜¸ì¶œ

2. ê³¼ì •
<div align="center">
<img src="https://github.com/user-attachments/assets/7891edbe-f1b0-486b-abc1-606a8e0de376">
</div>

  - í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ì ‘ì†í•˜ë©´ ì„œë²„ ì†Œì¼“ì˜ accept() ë©”ì„œë“œê°€ Socketì„ ë°˜í™˜
  - main threadëŠ” ì´ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Runnableì„ êµ¬í˜„í•œ Sessionì´ë¼ëŠ” ë³„ë„ì˜ ê°ì²´ë¥¼ ë§Œë“¤ê³ , ìƒˆë¡œìš´ threadì—ì„œ ì´ ê°ì²´ë¥¼ ì‹¤í–‰ (ì—¬ê¸°ì„œëŠ” Thread-0ì´ Sessionì„ ì‹¤í–‰)
  - Session ê°ì²´ì™€ Thread-0ì€ ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ì™€ ë©”ì„¸ì§€ë¥¼ ì£¼ê³  ë°›ìŒ

<div align="center">
<img src="https://github.com/user-attachments/assets/a070420b-c209-43e5-85e8-bc512993eab0">
</div>

  - ìƒˆë¡œìš´ TCP ì—°ê²°ì´ ë°œìƒí•˜ë©´, main threadëŠ” ìƒˆë¡œìš´ Session ê°ì²´ë¥¼ ë³„ë„ì˜ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ (ì´ ê³¼ì •ì„ ë°˜ë³µ)
  - Session ê°ì²´ì™€ Thread-1ì€ ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ì™€ ë©”ì„¸ì§€ë¥¼ ì£¼ê³  ë°›ìŒ

3. ì—­í• ì˜ ë¶„ë¦¬
   - main thread : ìƒˆë¡œìš´ ì—°ê²°ì´ ìˆì„ ë•Œë§ˆë‹¤ Session ê°ì²´ì™€ ë³„ë„ Threadë¥¼ ìƒì„±í•˜ê³ , ë³„ë„ì˜ Threadê°€ Session ê°ì²´ë¥¼ ì‹¤í–‰í•˜ë„ë¡ í•¨
   - Session ë‹´ë‹¹ thread : Sessionì„ ë‹´ë‹¹í•˜ëŠ” threadëŠ” ìì‹ ì˜ ì†Œì¼“ì´ ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ì™€ ë©”ì„¸ì§€ë¥¼ ë°˜ë³µí•´ì„œ ì£¼ê³  ë°›ëŠ” ì—­í•  ë‹´ë‹¹

4. ì½”ë“œ
   - ClientV3 (/tcp/v3/ClientV3)
```java
package network.tcp.v3;

import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;
import java.net.Socket;
import java.util.Scanner;

import static util.MyLogger.log;

public class ClientV3 {
    private static final int PORT = 12345; // PORT

    public static void main(String[] args) throws IOException {
        log(" í´ë¼ì´ì–¸íŠ¸ ì‹œì‘");

        Socket socket = new Socket("localhost", PORT);// Host : Localhost > TCP/IPë¥¼ í†µí•´ localhost:portë¡œ ì ‘ì†

        DataInputStream input = new DataInputStream(socket.getInputStream()); // Socketì˜ InputStreamì„ DataInputStream ë³´ì¡°ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ì‚¬ìš©
        DataOutputStream output = new DataOutputStream(socket.getOutputStream());// Socketì˜ OutputStreamì„ DataOutputStream ë³´ì¡°ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ì‚¬ìš©

        log("ì†Œì¼“ ì—°ê²°: " + socket);

        Scanner scanner = new Scanner(System.in);

        while (true) {
            System.out.print("ì „ì†¡ ë¬¸ì: ");
            String toSend = scanner.nextLine();

            // ì„œë²„ë¡œë¶€í„° ë¬¸ì ë³´ë‚´ê¸°
            output.writeUTF(toSend);
            log("client -> server: " + toSend);

            // exitë¼ê³  ì…ë ¥í•˜ë©´ ì¢…ë£Œ
            if(toSend.equals("exit")) {
                break;
            }

            // ì„œë²„ë¡œë¶€í„° ë¬¸ì ë°›ê¸°
            String received = input.readUTF();
            log("client <- server: " + received);
        }

        // ìì› ì •ë¦¬
        log("ì—°ê²° ì¢…ë£Œ: " + socket);
        input.close();
        output.close();
        socket.close();
    }
}
```
  - í´ë¼ì´ì–¸íŠ¸ ì½”ë“œëŠ” ê¸°ì¡´ ì½”ë“œì™€ ë™ì¼


   - SessionV3 (/tcp/v3/SessionV3)
```java
package network.tcp.v3;

import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;
import java.net.Socket;

import static util.MyLogger.log;

public class SessionV3 implements Runnable { // ë³„ë„ì˜ Threadì—ì„œ êµ¬í˜„ì„ ìœ„í•´ Runnable Implement
    private final Socket socket; // Session ê°ì²´ ë‚´ë¶€ì— socket í•„ìš”

    public SessionV3(Socket socket) {
        this.socket = socket; // ìƒì„±ìë¡œ ë°›ìŒ
    }

    @Override
    public void run() {
        try {
            DataInputStream input = new DataInputStream(socket.getInputStream());
            DataOutputStream output = new DataOutputStream(socket.getOutputStream());

            while (true) {
                // í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë¬¸ì ë°›ê¸°
                String received = input.readUTF(); // ì„œë²„ ì…ì¥ì—ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ ë©”ì„¸ì§€ë¥¼ ë°›ìŒ
                log("client -> server: "  + received);

                // ë§Œì•½, ë°›ì€ ë©”ì„¸ì§€ê°€ exitë¼ë©´ ì¢…ë£Œ
                if(received.equals("exit")) {
                    break;
                }

                // í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë¬¸ì ë³´ë‚´ê¸°
                String toSend = received + " World!";
                output.writeUTF(toSend);
                log("client <- server: " + toSend);
            }

            // ìì› ì •ë¦¬
            log("ì—°ê²° ì¢…ë£Œ: " + socket);
            input.close();
            output.close();
            socket.close();
            
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }
}
```
  - Sessionì˜ ëª©ì ì€ ì†Œì¼“ì´ ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ì™€ ë©”ì„¸ì§€ë¥¼ ë°˜ë³µí•´ì„œ ì£¼ê³  ë°›ëŠ” ê²ƒ
  - ìƒì„±ìë¥¼ í†µí•´ Socket ê°ì²´ë¥¼ ì…ë ¥ ë°›ìŒ
  - Runnableì„ êµ¬í˜„í•´ì„œ ë³„ë„ì˜ Threadì—ì„œ ì‹¤í–‰

  - ServerV3 (/tcp/v2/ServerV3)
```java
package network.tcp.v3;

import java.io.IOException;
import java.net.ServerSocket;
import java.net.Socket;

import static util.MyLogger.log;

public class ServerV3 {
    private static final int PORT = 12345;

    public static void main(String[] args) throws IOException {
        log(" ì„œë²„ ì‹œì‘"); // MyLogger Static Import

        ServerSocket serverSocket = new ServerSocket(PORT); // ì„œë²„ ìƒì„± (PORT ê°œë°©)

        log("ì„œë²„ ì†Œì¼“ ì‹œì‘ - Listening Port: " + PORT);
        
        while(true) {
            Socket socket = serverSocket.accept(); // ë¸”ë¡œí‚¹
            log("ì†Œì¼“ ì—°ê²°: " + socket);

            SessionV3 session = new SessionV3(socket); // Session ê°ì²´ ìƒì„±

            Thread thread = new Thread(session);// ë³„ë„ì˜ thread ìƒì„±
            thread.start(); // thread ì‹¤í–‰
        }
    }
}
```
  - main threadê°€ ì‘ë™í•˜ëŠ” ë¶€ë¶„
  - main threadëŠ” ì„œë²„ ì†Œì¼“ì„ ìƒì„±í•˜ê³ , serverSocket.accept()ì„ í˜¸ì¶œí•´ì„œ ì—°ê²° ëŒ€ê¸°
  - ìƒˆë¡œìš´ ì—°ê²°ì´ ì¶”ê°€ë  ë•Œ ë§ˆë‹¤, Session ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , ë³„ë„ì˜ threadì—ì„œ Session ê°ì²´ ì‹¤í–‰
  - ìœ„ ê³¼ì • ë°˜ë³µ

5. ì‹¤í–‰ ê²°ê³¼
   - ClientV3
```
19:27:03.161 [     main]  í´ë¼ì´ì–¸íŠ¸ ì‹œì‘
19:27:03.177 [     main] ì†Œì¼“ ì—°ê²°: Socket[addr=localhost/127.0.0.1,port=12345,localport=6290]
ì „ì†¡ ë¬¸ì: hello
19:28:16.850 [     main] client -> server: hello
19:28:16.850 [     main] client <- server: hello World!
ì „ì†¡ ë¬¸ì: exit
19:28:54.726 [     main] client -> server: exit
19:28:54.726 [     main] ì—°ê²° ì¢…ë£Œ: Socket[addr=localhost/127.0.0.1,port=12345,localport=6290]
```

   - ClientV3-2
```
19:28:36.685 [     main]  í´ë¼ì´ì–¸íŠ¸ ì‹œì‘
19:28:36.718 [     main] ì†Œì¼“ ì—°ê²°: Socket[addr=localhost/127.0.0.1,port=12345,localport=6318]
ì „ì†¡ ë¬¸ì: hihi
19:28:41.230 [     main] client -> server: hihi
19:28:41.230 [     main] client <- server: hihi World!
ì „ì†¡ ë¬¸ì: exit
19:28:59.961 [     main] client -> server: exit
19:28:59.961 [     main] ì—°ê²° ì¢…ë£Œ: Socket[addr=localhost/127.0.0.1,port=12345,localport=6318]
```

   - ServerV3
```
19:26:51.210 [     main]  ì„œë²„ ì‹œì‘
19:26:51.226 [     main] ì„œë²„ ì†Œì¼“ ì‹œì‘ - Listening Port: 12345
19:27:03.177 [     main] ì†Œì¼“ ì—°ê²°: Socket[addr=/127.0.0.1,port=6290,localport=12345]
19:28:16.850 [ Thread-0] client -> server: hello // ClientV3
19:28:16.850 [ Thread-0] client <- server: hello World!
19:28:36.703 [     main] ì†Œì¼“ ì—°ê²°: Socket[addr=/127.0.0.1,port=6318,localport=12345]
19:28:41.230 [ Thread-1] client -> server: hihi // ClientV3-2
19:28:41.230 [ Thread-1] client <- server: hihi World!
19:28:54.726 [ Thread-0] client -> server: exit
19:28:54.726 [ Thread-0] ì—°ê²° ì¢…ë£Œ: Socket[addr=/127.0.0.1,port=6290,localport=12345]
19:28:59.961 [ Thread-1] client -> server: exit
19:28:59.961 [ Thread-1] ì—°ê²° ì¢…ë£Œ: Socket[addr=/127.0.0.1,port=6318,localport=12345]
```

  - ì—¬ëŸ¬ ì„œë²„ê°€ ì ‘ì†í•´ë„ ë¬¸ì œ ì—†ì´ ì‘ë™
  - ê°ê° ì—°ê²°ì´ ë³„ë„ì˜ threadì—ì„œ ì²˜ë¦¬ë˜ëŠ” ê²ƒ í™•ì¸ ê°€ëŠ¥
  - ì„œë²„ ì†Œì¼“ì„ í†µí•´ ì†Œì¼“ì„ ì—°ê²°í•˜ëŠ” ë¶€ë¶„ê³¼ ê° í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë©”ì„¸ì§€ë¥¼ ì£¼ê³  ë°›ëŠ” ë¶€ë¶„ì´ ë³„ë„ì˜ threadë¡œ ë‚˜ëˆ ì§
  - Blocking ë˜ëŠ” ë¶€ë¶„ì€ ë³„ë„ì˜ Threadë¡œ ë‚˜ëˆ„ì–´ ì‹¤í–‰í•´ì•¼ í•¨

-----
### ë¬¸ì œì 
-----
1. ì‹¤í–‰ ì¤‘ì¸ í´ë¼ì´ì–¸íŠ¸ë¥¼ InteliJì˜ ë¹¨ê°„ìƒ‰ Stop ë²„íŠ¼ì„ ëˆŒëŸ¬ ì§ì ‘ ì¢…ë£Œí•˜ë©´?
  - MAC
```
16:13:06.075 [     main] ì„œë²„ ì‹œì‘
16:13:06.076 [     main] ì„œë²„ ì†Œì¼“ ì‹œì‘ - ë¦¬ìŠ¤ë‹ í¬íŠ¸: 12345
16:13:07.471 [     main] ì†Œì¼“ ì—°ê²°: Socket[addr=/127.0.0.1,port=57110,localport=12345]
Exception in thread "Thread-0" java.lang.RuntimeException: java.io.EOFException
    at network.tcp.v3.SessionV3.run(SessionV3.java:45)
    at java.base/java.lang.Thread.run(Thread.java:1570)
Caused by: java.io.EOFException
    at java.base/java.io.DataInputStream.readFully(DataInputStream.java:210)
    at java.base/java.io.DataInputStream.readUnsignedShort(DataInputStream.java:341)
    at java.base/java.io.DataInputStream.readUTF(DataInputStream.java:575)
    at java.base/java.io.DataInputStream.readUTF(DataInputStream.java:550)
    at network.tcp.v3.SessionV3.run(SessionV3.java:26)
... 1 more
```

  - Windows
```
19:33:46.946 [     main]  ì„œë²„ ì‹œì‘
19:33:46.964 [     main] ì„œë²„ ì†Œì¼“ ì‹œì‘ - Listening Port: 12345
19:33:51.986 [     main] ì†Œì¼“ ì—°ê²°: Socket[addr=/127.0.0.1,port=6460,localport=12345]
 Exception in thread "Thread-0" java.lang.RuntimeException: java.net.SocketException: Connection reset
	at network.tcp.v3.SessionV3.run(SessionV3.java:46)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.net.SocketException: Connection reset
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:318)
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346)
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796)
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099)
	at java.base/java.io.DataInputStream.readFully(DataInputStream.java:208)
	at java.base/java.io.DataInputStream.readUnsignedShort(DataInputStream.java:341)
	at java.base/java.io.DataInputStream.readUTF(DataInputStream.java:575)
	at java.base/java.io.DataInputStream.readUTF(DataInputStream.java:550)
	at network.tcp.v3.SessionV3.run(SessionV3.java:25)
	... 1 more
```

  - ìœˆë„ìš°ì˜ ê²½ìš° java.io.EOFExcpetionì´ ì•„ë‹ˆë¼ java.net.SocketException: Connection reset ë°œìƒ
  - ë‘˜ì˜ ì°¨ì´ê°€ ë°œìƒí•˜ëŠ” ì´ìœ 
    + í´ë¼ì´ì–¸íŠ¸ ì—°ê²°ì„ ì§ì ‘ ì¢…ë£Œí•˜ë©´ í´ë¼ì´ì–¸íŠ¸ í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œë˜ë©´ì„œ, í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ì˜ TCPë„ í•¨ê»˜ ì¢…ë£Œ
    + ì´ ë•Œ, ì†Œì¼“ì„ ì •ìƒì ìœ¼ë¡œ ë‹«ì§€ ì•Šê³  í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí–ˆê¸° ë–„ë¬¸ì— ê° OSëŠ” ë‚¨ì•„ìˆëŠ” TCP ì—°ê²°ì„ ì¢…ë£Œí•˜ë ¤ê³  ì‹œë„
    + ì´ ë•Œ, MACê³¼ ìœˆë„ìš° OSì˜ TCP ì—°ê²° ì •ë¦¬ ë°©ì‹ì´ ë‹¤ë¦„
      * MAC : TCP ì—°ê²° ì •ìƒ ì¢…ë£Œ
      * ìœˆë„ìš° : TCP ì—°ê²° ê°•ì œ ì¢…ë£Œ


  - í´ë¼ì´ì–¸íŠ¸ì˜ ì—°ê²°ì„ ì§ì ‘ ì¢…ë£Œí•˜ë©´ í´ë¼ì´ì–¸íŠ¸ í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œë˜ì–´, í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ì˜ TCP ì—°ê²°ë„ í•¨ê»˜ ì¢…ë£Œ
  - ì´ ë•Œ, ì„œë²„ì—ì„œ readUTF()ë¡œ í´ë¼ì´ì–¸íŠ¸ë¡œ ë©”ì„¸ì§€ë¥¼ ì½ìœ¼ë ¤ê³  í•˜ë©´, EOFException ë°œìƒ (EOF(íŒŒì¼ì˜ ë)ì€ ì—¬ê¸°ì„œ ì „ì†¡ì˜ ëì´ë¼ëŠ” ëœ»ìœ¼ë¡œ ì“°ì„)
  - ì´ëŠ”, ì†Œì¼“ì˜ TCP ì—°ê²°ì´ ì¢…ë£Œë˜ì—ˆê¸° ë•Œë¬¸ì— ë”ëŠ” ì½ì„ ìˆ˜ ìˆëŠ” ë©”ì„¸ì§€ê°€ ì—†ë‹¤ëŠ” ëœ»
  - ê·¸ëŸ°ë°, ì´ë ‡ê²Œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ì„œë²„ì—ì„œ ìì› ì •ë¦¬ ì½”ë“œë¥¼ í˜¸ì¶œí•˜ì§€ ëª»í•¨
  - ì¦‰, ì„œë²„ ë¡œê·¸ë¥¼ ë³´ë©´ ì—°ê²° ì¢…ë£Œ ë¡œê·¸ê°€ ì—†ìŒ
```java
    @Override
    public void run() {
        try {

            ...

            // ìì› ì •ë¦¬ ì²˜ë¦¬ë˜ì§€ ëª»í•¨
            log("ì—°ê²° ì¢…ë£Œ: " + socket);
            input.close();
            output.close();
            socket.close();

        } catch (IOException e) {
            throw new RuntimeException(e);
        }
```

2. ìë°” ê°ì²´ëŠ” GCê°€ ë˜ì§€ë§Œ, ìë°” ì™¸ë¶€ ìì›ì€ ìë™ìœ¼ë¡œ GCê°€ ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¯€ë¡œ ê¼­ ì •ë¦¬í•´ì¤˜ì•¼ í•¨
   - TCP ì—°ê²°ì˜ ê²½ìš° ìš´ì˜ì²´ì œê°€ ì–´ëŠì •ë„ ì—°ê²°ì„ ì •ë¦¬í•´ì£¼ì§€ë§Œ, ì§ì ‘ ì—°ê²°ì„ ì¢…ë£Œí•  ë•Œë³´ë‹¤ ë” ë§ì€ ì‹œê°„ ì†Œìš”ë  ìˆ˜ ìˆìŒ
   - ğŸ’¡ ìì› ì •ë¦¬ì˜ ê²½ìš° í´ë¼ì´ì–¸íŠ¸ëŠ” ì¢…ë£Œí•˜ê³  ë‹¤ì‹œ ì‹¤í–‰í•´ë„ ë˜ê³ , ì»´í“¨í„°ë¥¼ ìì£¼ ì¬ë¶€íŒ…í•˜ê¸°ë„ í•˜ì§€ë§Œ, ì„œë²„ì˜ ê²½ìš°ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ê³„ì† ì‚´ì•„ì„œ ì‹¤í–‰ë˜ì–´ì•¼ í•˜ë¯€ë¡œ, ì‚¬ìš©í•œ ìì›ì„ ì‚¬ìš© í›„ ì¦‰ê° ì •ë¦¬í•´ì•¼ í•¨
