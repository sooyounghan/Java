-----
### Executor ì˜ˆì™¸ ì •ì±…
-----
1. ìƒì‚°ì ì†Œë¹„ì ë¬¸ì œë¥¼ ì‹¤ë¬´ì—ì„œ ì‚¬ìš©í•  ë•ŒëŠ”, ê²°êµ­ ì†Œë¹„ìê°€ ì²˜ë¦¬í•  ìˆ˜ ì—†ì„ ì •ë„ë¡œ ìƒì‚° ìš”ì²­ì´ ê°€ë“ ì°¨ë©´ ì–´ë–»ê²Œ í• ì§€ë¥¼ ì •í•´ì•¼ í•¨
2. ì¸ì§€í•  ìˆ˜ ìˆê²Œ ë¡œê·¸ë„ ë‚¨ê²¨ì•¼ í•˜ê³ , ì‚¬ìš©ìì—ê²Œ í˜„ì¬ ì‹œìŠ¤í…œì— ë¬¸ì œê°€ ìˆë‹¤ê³  ì•Œë¦¬ëŠ” ê²ƒë„ í•„ìš”
3. ì´ëŸ° ê²ƒì„ ìœ„í•´ ì˜ˆì™¸ ì •ì±…ì´ í•„ìš”
  - ThreadPoolExecutorì— ì‘ì—…ì„ ìš”ì²­í•  ë•Œ, íë„ ê°€ë“ì°¨ê³ , ì´ˆê³¼ ìŠ¤ë ˆë“œë„ ë”ëŠ” í• ë‹¹í•  ìˆ˜ ì—†ë‹¤ë©´ ì‘ì—…ì„ ê±°ì ˆ
  - ThreadPoolExecutorëŠ” ì‘ì—…ì„ ê±°ì ˆí•˜ëŠ” ë‹¤ì–‘í•œ ì •ì±…ì„ ì œê³µ
    + AbortPolicy : ìƒˆë¡œìš´ ì‘ì—…ì„ ì œì¶œí•  ë•Œ RejectedExecutionExceptionì„ ë°œìƒì‹œí‚´ (ê¸°ë³¸ ì •ì±…)
    + DiscardPolicy : ìƒˆë¡œìš´ ì‘ì—…ì„ ì¡°ìš©íˆ ë²„ë¦¼
    + CallerRunsPolicy : ìƒˆë¡œìš´ ì‘ì—…ì„ ì œì¶œí•œ ìŠ¤ë ˆë“œê°€ ëŒ€ì‹ í•´ì„œ ì§ì ‘ ì‘ì—…ì„ ì‹¤í–‰
    + ì‚¬ìš©ì ì •ì˜(RejectedExecutionHandler) : ì§ì ‘ ì •ì˜í•œ ê±°ì ˆ ì •ì±…ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

  - ì°¸ê³ ë¡œ ThreadPoolExecutorë¥¼ shutdown()í•˜ë©´ ì´í›„ì— ìš”ì²­í•˜ëŠ” ì‘ì—…ì„ ê±°ì ˆí•˜ëŠ”ë°, ì´ë•Œë„ ê°™ì€ ì •ì±…ì´ ì ìš©

4. AbortPolicy : ì‘ì—…ì´ ê±°ì ˆë˜ë©´ RejectedExecutionException ì„ ë˜ì§€ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆëŠ” ì •ì±…
  - RejectMainV1 (/thread/executor/reject)
```java
package thread.executor.reject;

import thread.executor.RunnableTask;

import java.util.concurrent.RejectedExecutionException;
import java.util.concurrent.SynchronousQueue;
import java.util.concurrent.ThreadPoolExecutor;
import java.util.concurrent.TimeUnit;

import static thread.util.MyLogger.log;

public class RejectMainV1 {
    public static void main(String[] args) {
        ThreadPoolExecutor es = new ThreadPoolExecutor(1, 1, 0, TimeUnit.SECONDS, new SynchronousQueue<>(), new ThreadPoolExecutor.AbortPolicy());

        es.submit(new RunnableTask("task1"));
        try {
            es.submit(new RunnableTask("task2"));
        } catch (RejectedExecutionException e) {
            log("ìš”ì²­ ì´ˆê³¼");
            // í¬ê¸° ë˜ëŠ” ë‹¤ì‹œ ì‹œë„ ë¡œì§ ì¶”ê°€í•˜ë©´ ë¨
            log(e);
        }

        es.close();
    }
}
```
  - ThreadPoolExecutor ìƒì„±ì ë§ˆì§€ë§‰ì— new ThreadPoolExecutor.AbortPolicy()ë¥¼ ì œê³µ
  - ê¸°ë³¸ ì •ì±…ì´ê¸° ë•Œë¬¸ì— ìƒëµ ê°€ëŠ¥
  - ìŠ¤ë ˆë“œëŠ” 1ê°œë§Œ ì‚¬ìš© : ì˜ˆì œë¥¼ ë‹¨ìˆœí•˜ê²Œ ë§Œë“¤ê¸° ìœ„í•´ íì— ì‘ì—…ì„ ë„£ì§€ ì•Šë„ë¡ SynchronousQueueë¥¼ ì‚¬ìš©
  - ì‹¤í–‰ ê²°ê³¼
```
17:42:55.171 [pool-1-thread-1] task1 ì‹œì‘
17:42:55.171 [     main] ìš”ì²­ ì´ˆê³¼
17:42:55.175 [     main] java.util.concurrent.RejectedExecutionException: Task java.util.concurrent.FutureTask@b1bc7ed[Not completed, task = java.util.concurrent.Executors$RunnableAdapter@1ddc4ec2[Wrapped task = thread.executor.RunnableTask@133314b]] rejected from java.util.concurrent.ThreadPoolExecutor@5b6f7412[Running, pool size = 1, active threads = 1, queued tasks = 0, completed tasks = 0]
17:42:56.189 [pool-1-thread-1] task1 ì™„ë£Œ
```

  - task1ì€ í’€ì˜ ìŠ¤ë ˆë“œê°€ ìˆ˜í–‰
  - task2ë¥¼ ìš”ì²­í•˜ë©´ í—ˆìš© ì‘ì—…ì„ ì´ˆê³¼í•˜ë¯€ë¡œ, RejectedExecutionException ë°œìƒ
  - RejectedExecutionException ì˜ˆì™¸ë¥¼ ì¡ì•„ì„œ ì‘ì—…ì„ í¬ê¸°í•˜ê±°ë‚˜, ì‚¬ìš©ìì—ê²Œ ì•Œë¦¬ê±°ë‚˜, ë‹¤ì‹œ ì‹œë„ í•˜ë©´ ë¨
  - ì¦‰, ì˜ˆì™¸ë¥¼ ì¡ì•„ì„œ í•„ìš” ì½”ë“œ ì§ì ‘ êµ¬í˜„ ë˜ëŠ” ë‹¤ë¥¸ ì •ì±… ì‚¬ìš©í•´ë„ ë¨

5. RejectedExecutionHandler
  - ë§ˆì§€ë§‰ì— ì „ë‹¬í•œ AbortPolicyëŠ” RejectedExecutionHandlerì˜ êµ¬í˜„ì²´
  - ThreadPoolExecutor ìƒì„±ìëŠ” RejectedExecutionHandlerì˜ êµ¬í˜„ì²´ë¥¼ ì „ë‹¬
```java
public interface RejectedExecutionHandler {
    void rejectedExecution(Runnable r, ThreadPoolExecutor executor);
}
```
```java
public static class AbortPolicy implements RejectedExecutionHandler {
    public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {
        throw new RejectedExecutionException("Task " + r.toString() + " rejected from " + e.toString());
    }
}
```
  - ThreadPoolExecutorëŠ” ê±°ì ˆí•´ì•¼ í•˜ëŠ” ìƒí™©ì´ ë°œìƒí•˜ë©´ ì—¬ê¸°ì— ìˆëŠ” rejectedExecution()ì„ í˜¸ì¶œ
  - AbortPolicyëŠ” RejectedExecutionExceptionì„ ë˜ì§€ëŠ” ê²ƒì„ í™•ì¸

6. DiscardPolicy : ê±°ì ˆëœ ì‘ì—…ì„ ë¬´ì‹œí•˜ê³  ì•„ë¬´ëŸ° ì˜ˆì™¸ë„ ë°œìƒì‹œí‚¤ì§€ ì•ŠìŒ
  - RejectMainV2
```java
package thread.executor.reject;

import thread.executor.RunnableTask;

import java.util.concurrent.RejectedExecutionException;
import java.util.concurrent.SynchronousQueue;
import java.util.concurrent.ThreadPoolExecutor;
import java.util.concurrent.TimeUnit;

import static thread.util.MyLogger.log;

public class RejectMainV2 {
    public static void main(String[] args) {
        ThreadPoolExecutor es = new ThreadPoolExecutor(1, 1, 0, TimeUnit.SECONDS, new SynchronousQueue<>(), new ThreadPoolExecutor.DiscardPolicy());

        es.submit(new RunnableTask("task1"));
        es.submit(new RunnableTask("task2"));
        es.submit(new RunnableTask("task3"));

        es.close();
    }
}
```
  - ThreadPoolExecutor ìƒì„±ì ë§ˆì§€ë§‰ì— new ThreadPoolExecutor.DiscardPolicy()ë¥¼ ì œê³µ
  - ì‹¤í–‰ ê²°ê³¼
```
17:48:39.142 [pool-1-thread-1] task1 ì‹œì‘
17:48:40.162 [pool-1-thread-1] task1 ì™„ë£Œ
```

  - task2, task3ì€ ê±°ì ˆ
  - DiscardPolicyëŠ” ì¡°ìš©íˆ ë²„ë¦¬ëŠ” ì •ì±…
  - ë‹¤ìŒ êµ¬í˜„ ì½”ë“œë¥¼ ë³´ë©´ ì™œ ì¡°ìš©íˆ ë²„ë¦¬ëŠ” ì •ì±…ì¸ì§€ ì´í•´ê°€ ë  ê²ƒ
```java
public static class DiscardPolicy implements RejectedExecutionHandler {
    public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {
        // empty
    }
}
```

7. CallerRunsPolicy : í˜¸ì¶œí•œ ìŠ¤ë ˆë“œê°€ ì§ì ‘ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê²Œ í•˜ë¯€ë¡œ, ìƒˆë¡œìš´ ì‘ì—…ì„ ì œì¶œí•˜ëŠ” ìŠ¤ë ˆë“œì˜ ì†ë„ê°€ ëŠë ¤ì§ˆ ìˆ˜ ìˆìŒ
  - RejectMainV3
```java
package thread.executor.reject;

import thread.executor.RunnableTask;

import java.util.concurrent.RejectedExecutionException;
import java.util.concurrent.SynchronousQueue;
import java.util.concurrent.ThreadPoolExecutor;
import java.util.concurrent.TimeUnit;

import static thread.util.MyLogger.log;

public class RejectMainV3 {
    public static void main(String[] args) {
        ThreadPoolExecutor es = new ThreadPoolExecutor(1, 1, 0, TimeUnit.SECONDS, new SynchronousQueue<>(), new ThreadPoolExecutor.CallerRunsPolicy());

        es.submit(new RunnableTask("task1"));
        es.submit(new RunnableTask("task2"));
        es.submit(new RunnableTask("task3"));
        es.submit(new RunnableTask("task4"));

        es.close();
    }
}
```
```
18:15:09.629 [pool-1-thread-1] task1 ì‹œì‘
18:15:09.629 [     main] task2 ì‹œì‘
18:15:10.650 [pool-1-thread-1] task1 ì™„ë£Œ
18:15:10.650 [     main] task2 ì™„ë£Œ
18:15:10.650 [     main] task3 ì‹œì‘
18:15:11.664 [     main] task3 ì™„ë£Œ
18:15:11.664 [pool-1-thread-1] task4 ì‹œì‘
18:15:12.677 [pool-1-thread-1] task4 ì™„ë£Œ
```
  - task1ì€ ìŠ¤ë ˆë“œ í’€ì— ìŠ¤ë ˆë“œê°€ ìˆì–´ì„œ ìˆ˜í–‰
  - task2ëŠ” ìŠ¤ë ˆë“œ í’€ì— ë³´ê´€í•  íë„ ì—†ê³ , ì‘ì—…í•  ìŠ¤ë ˆë“œê°€ ì—†ìœ¼ë¯€ë¡œ ê±°ì ˆí•´ì•¼ í•¨
  - ì´ ë•Œ ì‘ì—…ì„ ê±°ì ˆí•˜ëŠ” ëŒ€ì‹ ì—, ì‘ì—…ì„ ìš”ì²­í•œ ìŠ¤ë ˆë“œì— ëŒ€ì‹  ì¼ì„ ì‹œí‚´
  - task2ì˜ ì‘ì—…ì„ main ìŠ¤ë ˆë“œê°€ ìˆ˜í–‰í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ

  - ì´ ì •ì±…ì˜ íŠ¹ì§•ì€ ìƒì‚°ì ìŠ¤ë ˆë“œê°€ ì†Œë¹„ì ëŒ€ì‹  ì¼ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒë„ ìˆì§€ë§Œ, ìƒì‚°ì ìŠ¤ë ˆë“œê°€ ëŒ€ì‹  ì¼ì„ ìˆ˜í–‰í•˜ëŠ” ë•ë¶„ì— ì‘ì—…ì˜ ìƒì‚° ìì²´ê°€ ëŠë ¤ì§„ë‹¤ëŠ” ì 
  - ğŸ’¡ ë•ë¶„ì— ì‘ì—…ì˜ ìƒì‚° ì†ë„ê°€ ë„ˆë¬´ ë¹ ë¥´ë‹¤ë©´, ìƒì‚° ì†ë„ë¥¼ ì¡°ì ˆí•  ìˆ˜ ìˆìŒ
  - ì›ë˜ëŒ€ë¡œ í•˜ë©´ main ìŠ¤ë ˆë“œê°€ task1, task2, task3, task4ë¥¼ ì—°ì†í•´ì„œ ë°”ë¡œ ìƒì‚°í•´ì•¼ í•¨
  - CallerRunsPolicy ì •ì±… ë•ë¶„ì— main ìŠ¤ë ˆë“œëŠ” task2 ë¥¼ ë³¸ì¸ì´ ì§ì ‘ ì™„ë£Œí•˜ê³  ë‚˜ì„œì•¼ task3ì„ ìƒì‚°í•  ìˆ˜ ìˆìŒ
  - ê²°ê³¼ì ìœ¼ë¡œ ìƒì‚° ì†ë„ê°€ ì¡°ì ˆ

```java
public static class CallerRunsPolicy implements RejectedExecutionHandler {
    public void rejectedExecution(Runnable r, ThreadPoolExecutor e) { // main ìŠ¤ë ˆë“œê°€ í˜¸ì¶œ
        if (!e.isShutdown()) { //
            r.run(); // main ìŠ¤ë ˆë“œê°€ ì‹¤í–‰
        }
    }
}
```
  - r.run() : ë³„ë„ì˜ ìŠ¤ë ˆë“œì—ì„œ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ main ìŠ¤ë ˆë“œê°€ ì§ì ‘ ìˆ˜í–‰
  - ì°¸ê³ ë¡œ ThreadPoolExecutorë¥¼ shutdown()ì„ í•˜ë©´ ì´í›„ì— ìš”ì²­í•˜ëŠ” ì‘ì—…ì„ ê±°ì ˆí•˜ëŠ”ë°, ì´ë•Œë„ ê°™ì€ ì •ì±…ì´ ì ìš©
  - ğŸ’¡ ê·¸ëŸ°ë° CallerRunsPolicy ì •ì±…ì€ shutdown() ì´í›„ì—ë„ ì‘ì—…ì„ ìˆ˜í–‰
  - ğŸ’¡ ë”°ë¼ì„œ shutdown() ì¡°ê±´ì„ ì²´í¬í•´ì„œ ì´ ê²½ìš°ì—ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•˜ì§€ ì•Šë„ë¡ í•´ì•¼ í•¨

8. ì‚¬ìš©ì ì •ì˜
   - ì‚¬ìš©ì ì •ì˜(RejectedExecutionHandler) : ì‚¬ìš©ìëŠ” RejectedExecutionHandler ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„
í•˜ì—¬ ìì‹ ë§Œì˜ ê±°ì ˆ ì²˜ë¦¬ ì „ëµì„ ì •ì˜í•  ìˆ˜ ìˆìŒ
   - ì´ë¥¼ í†µí•´ íŠ¹ì • ìš”êµ¬ì‚¬í•­ì— ë§ëŠ” ì‘ì—… ê±°ì ˆ ë°©ì‹ì„ ì„¤ì •
   - RejectMainV4
```java
package thread.executor.reject;

import thread.executor.RunnableTask;

import java.util.concurrent.RejectedExecutionHandler;
import java.util.concurrent.SynchronousQueue;
import java.util.concurrent.ThreadPoolExecutor;
import java.util.concurrent.TimeUnit;
import java.util.concurrent.atomic.AtomicInteger;

import static thread.util.MyLogger.log;

public class RejectMainV4 {
    public static void main(String[] args) {
        ThreadPoolExecutor es = new ThreadPoolExecutor(1, 1, 0, TimeUnit.SECONDS, new SynchronousQueue<>(), new MyRejectExceptionHandler());

        es.submit(new RunnableTask("task1"));
        es.submit(new RunnableTask("task2"));
        es.submit(new RunnableTask("task3"));

        es.close();
    }

    static class MyRejectExceptionHandler implements RejectedExecutionHandler {
        static AtomicInteger count = new AtomicInteger(0);

        @Override
        public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {
            int i = count.incrementAndGet();
            log("[ê²½ê³ ] ê±°ì ˆëœ ëˆ„ì  ì‘ì—… ìˆ˜ : " + i);
        }
    }
}
```
   - ê±°ì ˆëœ ì‘ì—…ì„ ë²„ë¦¬ì§€ë§Œ, ëŒ€ì‹ ì— ê²½ê³  ë¡œê·¸ë¥¼ ë‚¨ê²¨ì„œ ë¬¸ì œë¥¼ ì¸ì§€í•˜ë„ë¡ ì„¤ì •
```
18:24:04.568 [pool-1-thread-1] task1 ì‹œì‘
18:24:04.568 [     main] [ê²½ê³ ] ê±°ì ˆëœ ëˆ„ì  ì‘ì—… ìˆ˜ : 1
18:24:04.572 [     main] [ê²½ê³ ] ê±°ì ˆëœ ëˆ„ì  ì‘ì—… ìˆ˜ : 2
18:24:05.586 [pool-1-thread-1] task1 ì™„ë£Œ
```
