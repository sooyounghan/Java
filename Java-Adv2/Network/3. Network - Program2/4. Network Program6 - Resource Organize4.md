-----
### ë„¤íŠ¸ì›Œí¬ í”„ë¡œê·¸ë¨6 - ìì› ì •ë¦¬4
-----
1. ServerV6 (/tcp/v6)
```java
package network.tcp.v6;

import java.io.IOException;
import java.net.ServerSocket;
import java.net.Socket;

import static util.MyLogger.log;

public class ServerV6 {
    private static final int PORT = 12345;

    public static void main(String[] args) throws IOException {
        log(" ì„œë²„ ì‹œì‘"); // MyLogger Static Import

        SessionManagerV6 sessionManager = new SessionManagerV6(); // SessionManager
        
        ServerSocket serverSocket = new ServerSocket(PORT); // ì„œë²„ ìƒì„± (PORT ê°œë°©)

        log("ì„œë²„ ì†Œì¼“ ì‹œì‘ - Listening Port: " + PORT);

        // Shutdown Hook ë“±ë¡
        ShutdownHook shutdownHook = new ShutdownHook(serverSocket, sessionManager);
        
        Runtime.getRuntime().addShutdownHook(new Thread(shutdownHook, "shutdown")); // Shutdown Hook ë“±ë¡ (shutdownì´ë¼ëŠ” ìŠ¤ë ˆë“œë¡œ ë“±ë¡)

        try {
            while(true) {
                Socket socket = serverSocket.accept(); // ë¸”ë¡œí‚¹
                log("ì†Œì¼“ ì—°ê²°: " + socket);

                SessionV6 session = new SessionV6(socket, sessionManager); // Session ê°ì²´ ìƒì„±

                Thread thread = new Thread(session);// ë³„ë„ì˜ thread ìƒì„±
                thread.start(); // thread ì‹¤í–‰
            }
        } catch (IOException e) {
            log("ì„œë²„ ì†Œì¼“ ì¢…ë£Œ: " + e);
        }
    }
    
    // Shutdown Hook : ìë°”ê°€ ì¢…ë£Œë  ë•Œ ìë™ í˜¸ì¶œë˜ë„ë¡ ì„¤ì •
    static class ShutdownHook implements Runnable {

        private final ServerSocket serverSocket;
        private final SessionManagerV6 sessionManager;

        public ShutdownHook(ServerSocket serverSocket, SessionManagerV6 sessionManager) {
            this.serverSocket = serverSocket;
            this.sessionManager = sessionManager;
        }

        @Override
        public void run() {
            log("Shutdown Hook ì‹¤í–‰");
            
            try {
                
                sessionManager.closeAll(); // ì„¸ì…˜ ë§¤ë‹ˆì €ë¥¼ í†µí•´ ì„¸ì…˜ì˜ ëª¨ë“  ìì› ë‹«ê¸°
                serverSocket.close(); // ì„œë²„ ì†Œì¼“ ë‹«ê¸°
                
                Thread.sleep(1000); // ìì› ì •ë¦¬ ëŒ€ê¸° (ë‹¤ë¥¸ ìŠ¤ë ˆë“œì˜ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ê²ƒì„ ìœ„í•´ ì„¤ì •)
                
            } catch(Exception e) {
                throw new RuntimeException(e);
            }
        }
    }
}
```

2. ì…§ë‹¤ìš´ í›… ë“±ë¡
```java
// Shutdown Hook ë“±ë¡
ShutdownHook shutdownHook = new ShutdownHook(serverSocket, sessionManager);

Runtime.getRuntime().addShutdownHook(new Thread(shutdownHook, "shutdown")); // Shutdown Hook ë“±ë¡ (shutdownì´ë¼ëŠ” ìŠ¤ë ˆë“œë¡œ ë“±ë¡)
```

  - Runtime.getRuntime().addShutdownHook() : ìë°” ì¢…ë£Œ ì‹œ í˜¸ì¶œë˜ëŠ” ì…§ë‹¤ìš´ í›… ë“±ë¡ ê°€ëŠ¥
  - ì…§ë‹¤ìš´ì´ ë°œìƒí–ˆì„ ë•Œ ì²˜ë¦¬í•  ì‘ì—…ê³¼ ìŠ¤ë ˆë“œë¥¼ ë“±ë¡í•˜ë©´ ë¨

3. ì…§ë‹¤ìš´ í›… ì‹¤í–‰ ì½”ë“œ
```java
@Override
public void run() {
    log("Shutdown Hook ì‹¤í–‰");

    try {

        sessionManager.closeAll(); // ì„¸ì…˜ ë§¤ë‹ˆì €ë¥¼ í†µí•´ ì„¸ì…˜ì˜ ëª¨ë“  ìì› ë‹«ê¸°
        serverSocket.close(); // ì„œë²„ ì†Œì¼“ ë‹«ê¸°

        Thread.sleep(1000); // ìì› ì •ë¦¬ ëŒ€ê¸° (ë‹¤ë¥¸ ìŠ¤ë ˆë“œì˜ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ê²ƒì„ ìœ„í•´ ì„¤ì •)

    } catch(Exception e) {
        throw new RuntimeException(e);
    }
}
```

<div align="center">
<img src="https://github.com/user-attachments/assets/95517278-0827-4d4d-8e26-6bfad79f85fb">
</div>

  - ì…§ë‹¤ìš´ í›…ì´ ì‹¤í–‰ë  ë•Œ ëª¨ë“  ìì› ì •ë¦¬
  - sessionManager.closeAll() : ëª¨ë“  ì„¸ì…˜ì´ ì‚¬ìš©í•˜ëŠ” ìì› (Socket, InputStream, OutputStream) ì •ë¦¬
  - serverSocket.close() : ì„œë²„ ì†Œì¼“ì„ ë‹«ìŒ

4. ìì› ì •ë¦¬ ëŒ€ê¸° ì´ìœ 
```java
Thread.sleep(1000); // ìì› ì •ë¦¬ ëŒ€ê¸° (ë‹¤ë¥¸ ìŠ¤ë ˆë“œì˜ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ê²ƒì„ ìœ„í•´ ì„¤ì •)
```
  - ë³´í†µ ëª¨ë“  Non-Demon Thread ì‹¤í–‰ì´ ì™„ë£Œë˜ë©´ ìë°” í”„ë¡œì„¸ìŠ¤ê°€ ì •ìƒ ì¢…ë£Œ
  - í•˜ì§€ë§Œ, ë‹¤ìŒê³¼ ê°™ì€ ì¢…ë£Œ ì¡´ì¬
    + ì‚¬ìš©ìê°€ Ctrl + Cë¥¼ ëˆŒëŸ¬ í”„ë¡œê·¸ë¨ ì¢…ë£Œ
    + kill ëª…ë ¹ ì „ë‹¬ (kill -9 ì œì™¸)
    + InteliJì˜ Stop ë²„íŠ¼

  - ì´ëŸ° ê²½ìš°ì—ëŠ” Non-Demon Threadì˜ ì¢…ë£Œ ì—¬ë¶€ì™€ ìƒê´€ ì—†ì´ ìë°” í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œ
  - ğŸ’¡ ë‹¨, ì…§ë‹¤ìš´ í›…ì˜ ì‹¤í–‰ì´ ëë‚  ë•Œ ê¹Œì§€ëŠ” ê¸°ë‹¤ë ¤ì¤Œ
  - ğŸ’¡ ì…§ë‹¤ìš´ í›…ì˜ ì‹¤í–‰ì´ ëë‚˜ë©´ Non-Demon Threadì˜ ì‹¤í–‰ ì—¬ë¶€ì™€ ìƒê´€ ì—†ì´ ìë°” í”„ë¡œì„¸ìŠ¤ëŠ” ì¢…ë£Œ
  - ë”°ë¼ì„œ, ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ìì›ì„ ì¢…ë£Œí•˜ê±°ë‚˜ í•„ìš”í•œ ë¡œê·¸ë¥¼ ë‚¨ê¸¸ ìˆ˜ ìˆë„ë¡ ì…§ë‹¤ìš´ í›…ì˜ ì‹¤í–‰ì„ ì ì‹œ ëŒ€ê¸°

5. ì‹¤í–‰ ê²°ê³¼ - ì„œë²„ ì¢…ë£Œ ê²°ê³¼
```
17:32:32.246 [     main]  ì„œë²„ ì‹œì‘
17:32:32.254 [     main] ì„œë²„ ì†Œì¼“ ì‹œì‘ - Listening Port: 12345
17:32:41.287 [     main] ì†Œì¼“ ì—°ê²°: Socket[addr=/127.0.0.1,port=2918,localport=12345]
17:32:42.621 [ shutdown] Shutdown Hook ì‹¤í–‰ # 2ë²ˆ
17:32:42.621 [ Thread-0] java.net.SocketException: Socket closed # Thread-0 (ì…ë ¥ ëŒ€ê¸° ë°›ë˜ Blocking)
17:32:42.642 [ shutdown] ì—°ê²° ì¢…ë£Œ: Socket[addr=/127.0.0.1,port=2918,localport=12345] isClosed: true # 3, 4ë²ˆ
17:32:42.643 [     main] ì„œë²„ ì†Œì¼“ ì¢…ë£Œ: java.net.SocketException: Socket closed # 5ë²ˆ (ì„œë²„ ì†Œì¼“ì€ accept() Blocking)
```

  - ì„œë²„ë¥¼ ì¢…ë£Œí•˜ë©´ shutdown ìŠ¤ë ˆë“œê°€ shutdownHookì„ ì‹¤í–‰í•˜ê³ , ì„¸ì…˜ì˜ Socketì˜ ì—°ê²°ì„ close()ë¡œ ë‹«ìŒ
    + ```[ Thread-0] java.net.SocketException: Socket closed```
    + Sessionì˜ input.readUTF()ì—ì„œ ì…ë ¥ì„ ëŒ€ê¸°í•˜ëŠ” Thread-0 ìŠ¤ë ˆë“œëŠ” ```SocketException: Socket closed``` ì˜ˆì™¸ë¥¼ ë°›ê³  ì¢…ë£Œ (ì´ ì˜ˆì™¸ëŠ” ìì‹ ì˜ ì†Œì¼“ì„ ë‹«ì•˜ì„ ë•Œ ë°œìƒ)

  - shutdown ìŠ¤ë ˆë“œëŠ” ì„œë²„ ì†Œì¼“ì„ close()ë¡œ ë‹«ìŒ
    + ```[     main] ì„œë²„ ì†Œì¼“ ì¢…ë£Œ: java.net.SocketException: Socket closed```
    + serverSocket.accept()ì—ì„œ ëŒ€ê¸°í•˜ê³  ìˆë˜ main ìŠ¤ë ˆë“œëŠ” ```java.net.SocketException: Socket closed``` ì˜ˆì™¸ë¥¼ ë°›ê³  ì¢…ë£Œ
    
